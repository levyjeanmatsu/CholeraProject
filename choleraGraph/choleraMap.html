<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="map"></div>
<script>
  Plotly.d3.csv(
      "choleraDeathLocations.csv",
      function(err, rows) {
        function unpack(rows, key) {
          return rows.map(function(row) {
            return row[key];
          });
        }

        rows.map(function(row){
         if (row.deaths == 0) {
           row.type = 'pump';
         } else  {
           row.type = 'death';
         }
        });


        var types = ['pump', 'death'];

        var data = types.map(function(types) {
          var rowsFiltered = rows.filter(function(row) {
            return (row.type === types);
          });

          console.log(unpack(rowsFiltered, 'deaths'));
          return {
            type: 'scattermapbox',
            name: types,
            text: ['hello'],
            lat: unpack(rowsFiltered, 'lat'),
            lon: unpack(rowsFiltered, 'long'),

          };
        });

        var layout = {
          dragmode: "zoom",
          mapbox: { style: "open-street-map", center: { lat: 51.5073, lon: -0.1277 }, zoom: 12 },
          showlegend: true,
          margin: { r: 0, t: 0, b: 0, l: 0 }
        };

        var config = {mapboxAccessToken: 'pk.eyJ1IjoibGV2eWplYW4iLCJhIjoiY2tmZzRrdTBhMDF5eTJxcHAyc2oyeTUxbyJ9.4gtxzCh3vsajA99VB5fk7g'}

        Plotly.newPlot("map", data, layout, config);
      }
  );
</script>
</body>
</html>