<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plotly</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>
<body>


<div id='attackTable'></div>
<div id='choleraLine' ></div>

<script>
  // source : https://plotly.com/javascript/table/
  Plotly.d3.csv("choleraDeaths.csv", function(err, rows){

    function unpack(rows, key) {
      return rows.map(function(row) { return row[key]; });
    }

    var headerNames = Plotly.d3.keys(rows[0]);
    headerNames.push("Total Attacks");
    headerNames.push("Total Deaths");

    //setting date, attack, and death columns
    var headerValues = [];
    var cellValues = [];
    for (i = 0; i < headerNames.length; i++) {
        headerValues[i] = [headerNames[i]];
        cellValues[i] = unpack(rows, headerNames[i]);
    }
    console.log(cellValues);
    console.log(headerValues);
    console.log(cellValues[2][1]);

    prevTotDeaths = 0;
    prevTotAttacks = 0;
    //setting total attacks and total deaths
    for (i = 0; i < cellValues[3].length; i++) {
        totalAttacks = Number(cellValues[1][i])+prevTotAttacks;
        totalDeaths = Number(cellValues[2][i])+prevTotDeaths;
        cellValues[3][i] = totalAttacks.toString();
        cellValues[4][i] = totalDeaths.toString();
        prevTotDeaths = totalDeaths;
        prevTotAttacks = totalAttacks;
    }



    var tableData = [{
      type: 'table',
      columnwidth: [200,200,200,200,200],
      columnorder: [0,1,2,3,4],
      header: {
        values: headerValues,
        align: ["left"],
        line: {width: 1, color: 'rgb(50, 50, 50)'},
        fill: {color: ['#3A5B94']},
        font: {family: "Arial", size: 12, color: "white"}
      },
      cells: {
        values: cellValues,
        align: ["left"],
        line: {color: "black", width: 1},
        font: {family: "Arial", size: 12, color: ["black"]}
      }
    }];

    var attackTrace = {
      x: cellValues[0],
      y: cellValues[1],
      mode: 'lines+markers',
      name: 'Attacks',
      marker: {
        color: '#7EF594',
        size: 4
      },
      line: {
        color: '#7EF594',
        width: 2
      }
    };

    var deathTrace = {
      x: cellValues[0],
      y: cellValues[2],
      mode: 'lines+markers',
      name: 'Deaths',
      marker: {
        color: '#F5738A',
        size: 4
      },
      line: {
        color: '#F5738A',
        width: 2
      }
    };

    var totAttackTrace = {
      x: cellValues[0],
      y: cellValues[3],
      mode: 'lines+markers',
      name: 'Total Attacks',
      line: {
        color: '#2AA341',
        width: 2
      },
      marker: {
        color: '#2AA341',
        size: 4
      }
    };

    var totDeathTrace = {
      x: cellValues[0],
      y: cellValues[4],
      mode: 'lines+markers',
      name: 'Total Deaths',
      line: {
        color: '#C2293B',
        width: 2
      },
      marker: {
        color: '#C2293B',
        size: 4
      }
    };


    var lineData = [attackTrace, deathTrace, totAttackTrace, totDeathTrace];

    var tableLayout = {
      title: "Cholera Deaths and Attacks in 1854",
    };

    var layout = {
      title: "Cholera Deaths and Attacks in 1854",
      xaxis: {
        title: 'Date',
        tickangle: -45
      },
      yaxis: {
        title: 'Amount of Cases'
      },
      legend: {
        x: 1,
        xanchor: 'left',
        y: 1
      }
    };


    var config = {response: true};

    Plotly.newPlot('attackTable', tableData, tableLayout, config);

    Plotly.newPlot('choleraLine', lineData, layout, config);
  });
</script>

<div id='naplesTable'></div>
<script>
  Plotly.d3.csv("naplesCholeraAgeSexData.csv", function(err, rows){

    function unpack(rows, key) {
      return rows.map(function(row) { return row[key]; });
    }

    var headerNames = Plotly.d3.keys(rows[0]);

    var headerValues = [];
    var cellValues = [];
    for (i = 0; i < headerNames.length; i++) {
      headerValue = [headerNames[i]];
      headerValues[i] = headerValue;
      cellValue = unpack(rows, headerNames[i]);
      cellValues[i] = cellValue;
    }


    var naplesData = [{
      type: 'table',
      columnwidth: [150,600,1000],
      columnorder: [0,1,2,3],
      header: {
        values: headerValues,
        align: "center",
        line: {width: 1},
        fill: {color: ['#3A5B94']},
        font: {family: "Arial", size: 12, color: "white"}
      },
      cells: {
        values: cellValues,
        align: ["center", "center"],
        line: {color: "black", width: 1},
        font: {family: "Arial", size: 12, color: ["black"]}
      }
    }]

    var layout = {
      title: "Fatalities in Naples"
    }

    var config = {responsive: true};

    Plotly.newPlot('naplesTable', naplesData, layout);
  });
</script>

<div id='censusTable'></div>
<div id='malePie'></div>
<div id='femalePie'></div>
<div id='maleBar'></div>
<div id='femaleBar'></div>
<div id='totalPie'></div>

<script>
  Plotly.d3.csv("UKcensus1851.csv", function(err, rows){

    function unpack(rows, key) {
      return rows.map(function(row) { return row[key]; });
    }

    var headerNames = Plotly.d3.keys(rows[0]);
    headerNames.push("Total");

    var headerValues = [];
    var cellValues = [];
    for (i = 0; i < headerNames.length; i++) {
      headerValue = [headerNames[i]];
      headerValues[i] = headerValue;
      cellValue = unpack(rows, headerNames[i]);
      cellValues[i] = cellValue;
    }

    //source: https://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript
    function formatCommas(x) {
      return x.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    }

    for (i=0; i < cellValues[3].length; i++) {
      males = cellValues[1][i];
      females = cellValues[2][i];
      total = Number(males) + Number(females);
      cellValues[3][i] = total;
    }



    var censusData = [{
      type: 'table',
      columnwidth: [300,600,1000],
      columnorder: [0,1,2,3],
      header: {
        values: headerValues,
        align: "center",
        line: {width: 1},
        fill: {color: ['#3A5B94']},
        font: {family: "Arial", size: 12, color: "white"}
      },
      cells: {
        values: cellValues,
        align: ["center", "center"],
        line: {color: "black", width: 1},
        font: {family: "Arial", size: 12, color: ["black"]}
      }
    }]

    var ageColors = ['rgb(141,211,199)','rgb(255,255,179)','rgb(190,186,218)','rgb(251,128,114)','rgb(128,177,211)','rgb(253,180,98)','rgb(179,222,105)','rgb(252,205,229)','rgb(217,217,217)'];

    var censusLayout = {
      title: "UK Census: Male and Females living in the UK at the same time"
    }

    var malePieData = [{
      values: cellValues[1],
      labels: cellValues[0],
      type: 'pie',
      marker: {
        colors: ageColors
      }
    }];

    var malePieLayout = {
      title: 'Men living in the UK by Age',
      height: 700,
      width: 1200
    };

    var femalePieData = [{
      values: cellValues[1],
      labels: cellValues[0],
      type: 'pie',
      marker: {
        colors: ageColors
      },
    }];

    var femalePieLayout = {
      title: 'Females Living in the UK by Age',
      height: 700,
      width: 1200
    };

    var maleAges = {
      x: cellValues[0],
      y: cellValues[1],
      name: 'Male Population',
      marker:{
        color: ageColors
      },
      type: 'bar'
    };

    var maleBarData = [maleAges];

    var maleBarLayout = {
      title: 'Males living in the UK by Age',
      barmode: 'group'};

    var femaleAges = {
      x: cellValues[0],
      y: cellValues[2],
      name: 'Female Population',
      marker:{
        color: ageColors
      },
      type: 'bar'
    };

    var femaleBarData = [femaleAges];

    var femaleBarLayout = {
      title: 'Females living in the UK by Age',
      barmode: 'group'};

    maleTotal = 0;
    femaleTotal = 0;
    for (i = 0; i < cellValues[1].length; i++) {
      currMale = Number(cellValues[1][i]);
      maleTotal = currMale + maleTotal;
      currFemale = Number(cellValues[2][i]);
      femaleTotal = currFemale + femaleTotal;
    }

    var totalPieData = [{
      values: [maleTotal,femaleTotal],
      labels: ['males', 'females'],
      marker: {
        colors: ['#8B9454','#BE8BE0']
      },
      type: 'pie'
    }];

    var totalPieLayout = {
      title: 'UK Population by Gender',
      height: 700,
      width: 1200
    };

    var config = {responsive: true};

    Plotly.newPlot('censusTable', censusData, censusLayout, config);
    Plotly.newPlot('malePie', malePieData, malePieLayout, config);
    Plotly.newPlot('femalePie',femalePieData, femalePieLayout, config);
    Plotly.newPlot('maleBar',maleBarData, maleBarLayout, config);
    Plotly.newPlot('femaleBar',femaleBarData, femaleBarLayout, config);
    Plotly.newPlot('totalPie',totalPieData, totalPieLayout, config);
  });

</script>

</body>
</html>